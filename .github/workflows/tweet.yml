name: Twitter Auto Post

on:
  schedule:
   - cron: "0 22 * * *"  # æ—¥æœ¬æ™‚é–“ 7:00ï¼ˆUTC 22:00ï¼‰
  workflow_dispatch:

jobs:
  tweet:
    runs-on: ubuntu-latest

    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’å–å¾—
        uses: actions/checkout@v3

      - name: Python ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python --version
          pip install --upgrade pip
          pip install tweepy google-generativeai requests

      - name: ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’ç¢ºèªï¼ˆãƒ‡ãƒãƒƒã‚°ï¼‰
        run: |
          echo "ğŸ“Œ ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:"
          pwd
          echo "ğŸ“Œ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§:"
          ls -la

      - name: "app.py ã®å­˜åœ¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒãƒƒã‚°ï¼‰"
        run: |
          if [ -f app.py ]; then
            echo "âœ… app.py found"
          else
            echo "âŒ app.py NOT found. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åœæ­¢ã—ã¾ã™ã€‚"
            exit 1
          fi

      - name: Twitter ã«ãƒ„ã‚¤ãƒ¼ãƒˆ
        env:
          API_KEY: ${{ secrets.API_KEY }}
          API_SECRET: ${{ secrets.API_SECRET }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          ACCESS_SECRET: ${{ secrets.ACCESS_SECRET }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          if [ -z "$API_KEY" ] || [ -z "$API_SECRET" ] || [ -z "$ACCESS_TOKEN" ] || [ -z "$ACCESS_SECRET" ] || [ -z "$GEMINI_API_KEY" ]; then
            echo "âŒ ç’°å¢ƒå¤‰æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚Secrets ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
            exit 1
          fi
          python app.py
