name: Twitter Auto Post

on:
  schedule:
    - cron: "55 21 * * *"  # JST 06:55ï¼ˆGitHub ã®é…å»¶å¯¾ç­–ï¼‰
    - cron: "55 2 * * *"   # JST 11:55ï¼ˆGitHub ã®é…å»¶å¯¾ç­–ï¼‰
    - cron: "55 11 * * *"  # JST 19:55ï¼ˆGitHub ã®é…å»¶å¯¾ç­–ï¼‰
  workflow_dispatch:

jobs:
  tweet:
    runs-on: ubuntu-latest

    steps:
      - name: å®Ÿè¡Œæ™‚é–“ã‚’è¨˜éŒ²ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        run: |
          export TZ=Asia/Tokyo
          date "+%Y-%m-%d %H:%M:%S %Z"

      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’å–å¾—
        uses: actions/checkout@v3

      - name: Python ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install --upgrade pip
          pip install tweepy google-generativeai requests

      - name: "app.py ã®å­˜åœ¨ã‚’ç¢ºèª"
        run: |
          if [ -f app.py ]; then
            echo "âœ… app.py found"
          else
            echo "âŒ app.py NOT found. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åœæ­¢ã—ã¾ã™ã€‚"
            exit 1
          fi

      - name: ç’°å¢ƒå¤‰æ•°ã®ãƒã‚§ãƒƒã‚¯
        env:
          API_KEY: ${{ secrets.API_KEY }}
          API_SECRET: ${{ secrets.API_SECRET }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          ACCESS_SECRET: ${{ secrets.ACCESS_SECRET }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          if [ -z "$API_KEY" ] || [ -z "$API_SECRET" ] || [ -z "$ACCESS_TOKEN" ] || [ -z "$ACCESS_SECRET" ] || [ -z "$GEMINI_API_KEY" ]; then
            echo "âŒ ç’°å¢ƒå¤‰æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚Secrets ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
            exit 1
          fi

      - name: Twitter ã«ãƒ„ã‚¤ãƒ¼ãƒˆï¼ˆå½“æ—¥ã®æ—¥æœ¬æ™‚é–“ã®æ—¥ä»˜ã‚’ä½¿ç”¨ï¼‰
        env:
          API_KEY: ${{ secrets.API_KEY }}
          API_SECRET: ${{ secrets.API_SECRET }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          ACCESS_SECRET: ${{ secrets.ACCESS_SECRET }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          export TZ=Asia/Tokyo
          TODAY=$(date '+%Y-%m-%d')
          echo "ğŸ“… ä»Šæ—¥ã®æ—¥ä»˜: $TODAY"
          python app.py "$TODAY"
